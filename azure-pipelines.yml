name: ci_$(SourceBranchName)_$(Date:yyyyMMdd)$(Rev:_r)

pool:
  vmImage: windows-2019

variables:
  versionSuffix: ${{ $(Build.BuildNumber) }}
  buildConfiguration: 'Release'
  solutionDirectory: '$(System.DefaultWorkingDirectory)/Selenium.Axe'
  
  outputDirectory: '$(solutionDirectory)/Selenium.Axe/bin/$(buildConfiguration)'

steps:
- script: dotnet restore
  displayName: dotnet restore
  workingDirectory: $(solutionDirectory)

- script: dotnet build --no-restore -c $(buildConfiguration) --version-suffix $(versionSuffix)
  displayName: dotnet build
  workingDirectory: $(solutionDirectory)

- script: dotnet test --no-restore
  displayName: dotnet test
  workingDirectory: $(solutionDirectory)

- task: PublishSymbols@2
  displayName: 'publish symbols'
  inputs:
    SearchPattern: '$(outputDirectory)/**/*.pdb'
    PublishSymbols: false
  continueOnError: true

- publish: $(outputDirectory)
  name: drop
  displayName: publish drop
